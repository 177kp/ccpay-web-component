<div class="govuk-width-container">

  <main class="govuk-main-wrapper">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">Case transactions</h1>
      </div>

      <div  class="govuk-grid-column-one-third" align="right" *ngIf="takePayment">
        <a [ngClass]="{ 'disable': !isAddFeeBtnEnabled} " (click)="redirectToFeeSearchPage($event)" class="button">Add a new fee</a>
       </div>
    </div> 

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds govuk-!-padding-bottom-6">
        <h3 class="heading-medium">CCD reference:</h3>
        <span> {{ ccdCaseNumber | ccdHyphens }}</span>
      </div>

      <div class="govuk-grid-column-full govuk-!-padding-bottom-3">
        <hr class="govuk-section-break govuk-section-break--visible">
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <td class="govuk-table__header" scope="col">Total payments</td>
              <td class="govuk-table__header" scope="col">Total remissions</td>
              <td class="govuk-table__header" scope="col">Amount due</td>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            <tr class="totalpayments govuk-table__row">
              <td class="govuk-table__cell">{{ totalPayments | currency :'GBP':'symbol':'1.2-2' }}</td>
              <td class="govuk-table__cell">{{ totalRemissions | currency :'GBP':'symbol':'1.2-2' }}</td>
              <td class="govuk-table__cell">{{ (totalFees - totalRemissions) - totalPayments | currency :'GBP':'symbol':'1.2-2'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <!-- No fees start -->
    <div *ngIf="paymentGroups?.length === 0">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <span class="heading-small">Exisiting fees</span>
        </div>

        <div class="govuk-grid-column-two-thirds" align="left">
          <table class="govuk-table">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <td class="govuk-table__header" scope="col">Code</td>
              <td class="govuk-table__header" scope="col">Description</td>
              <td class="govuk-table__header" scope="col">Volume</td>
              <td class="govuk-table__header" scope="col">Fee amount</td>
              <td class="govuk-table__header" scope="col">Calculated amount</td>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <td class="govuk-table__cell" colspan="5">No fees recorded</td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="govuk-grid-column-one-third" align="right">
          <table class="govuk-table">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <td class="govuk-table__header" scope="col">Group amount outstanding</td>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <td class="govuk-table__cell">Â£0.00</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- No fees end -->

    <div *ngFor="let paymentGroup of paymentGroups">

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full govuk-grid-column-full--gr">
        <span class="heading-medium">Group reference: {{paymentGroup.payment_group_reference}}</span>
      </div>
    </div>
      <div class="govuk-grid-row">

        <!--New Code start-->

        <div class="govuk-grid-column-full">
          <span class="heading-small">Exisiting fees</span>
        </div>
        <div class=feeclass>
        <table class="govuk-table">
          <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <td class="govuk-table__header" scope="col">Code</td>
            <td class="govuk-table__header" scope="col">Description</td>
            <td class="govuk-table__header" scope="col">Volume</td>
            <td class="govuk-table__header" scope="col">Fee amount</td>
            <td class="govuk-table__header" scope="col">Calculated amount</td>
            <td class="groupamount govuk-table__header" scope="col">Group amount outstanding</td>
          </tr>
          </thead>
          <tbody class="govuk-table__body" >
          <tr class="govuk-table__row"  *ngFor="let fee of paymentGroup.fees;  let i = index;">
            <td class="govuk-table__cell govuk-table__cell--col1">{{fee.code}}</td>
            <td class="govuk-table__cell govuk-table__cell--col2"> {{fee.description}} </td>
            <td class="govuk-table__cell govuk-table__cell--col3"> {{fee.volume}} </td>
            <td class="govuk-table__cell govuk-table__cell--col4"> {{ fee.calculated_amount/fee.volume | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
            <td class="govuk-table__cell govuk-table__cell--col5"> {{fee.calculated_amount | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
            <td class="govuk-table__cell govuk-table__cell--col6 govuk-table__custom--col6" [attr.rowspan]="paymentGroup.fees.length" *ngIf="i==0">
              {{getGroupOutstandingAmount(paymentGroup) | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
          </tr>
          </tbody>
          <tbody class="govuk-table__body" *ngIf="paymentGroup.fees.length==0">
          <td class="govuk-table__cell" colspan="6">No payments recorded</td>
          </tbody>
        </table>
      </div>
      </div>
    <div class="govuk-inset-text govuk-inset-text__no-border" *ngIf="paymentGroup.payments || paymentGroup.remissions">
      <details>
        <summary class="govuk-hidetext">
        <span class="summary">Allocated payments and remissions</span>
        </summary>

          <div class="panel panel-border-narrow">
              <!-- payments -->
                <table class="govuk-table">
                  <caption class="heading-medium headgovuk-table__caption">Payments</caption>
                  <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <td class="govuk-table__header" scope="col">Payment reference</td>
                        <td class="govuk-table__header" scope="col">Date created</td>
                        <td class="govuk-table__header" scope="col">Channel</td>
                        <td class="govuk-table__header" scope="col">Method</td>
                        <td class="govuk-table__header" scope="col">Amount</td>
                        <td class="govuk-table__header" scope="col">Allocation status</td>
                        <td class="govuk-table__header" scope="col">Status</td>
                      </tr>
                  </thead>
                  <tbody class="govuk-table__body" *ngIf="paymentGroup.payments?.length > 0">
                    <tr class="govuk-table__row"  *ngFor="let payment of paymentGroup.payments">
                        <td class="govuk-table__cell">
                          <a href="javascript:void(0)" (click)="goToPaymentViewComponent(paymentGroup.payment_group_reference, payment.reference, payment.method)">{{ payment.reference }}</a>
                        </td>
                        <td class="govuk-table__cell">{{ payment.date_created | date:'dd MMM yyyy HH:mm:ss' }}</td>
                        <td class="govuk-table__cell">{{ payment.channel }}</td>
                        <td class="govuk-table__cell">{{ payment.method }}</td>
                        <td class="govuk-table__cell">{{ payment.amount }}</td>
                        <td class="govuk-table__cell"> - </td>
                        <td class="govuk-table__cell">{{ payment.status }}</td>
                      </tr>
                  </tbody>
                  <tbody class="govuk-table__body" *ngIf="paymentGroup.payments?.length === 0">
                    <td class="govuk-table__cell" colspan="6">No payments recorded</td>
                  </tbody>
                </table>

                <!-- remissions -->
                <table class="govuk-table">
                  <caption class="heading-medium headgovuk-table__caption">Remissions</caption>
                  <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <td class="govuk-table__header" scope="col">Remission reference</td>
                        <td class="govuk-table__header" scope="col">Date created</td>
                        <td class="govuk-table__header" scope="col">Remission code</td>
                        <td class="govuk-table__header" scope="col">Fee applied against</td>
                        <td class="govuk-table__header" scope="col">Remission amount</td>
                      </tr>
                  </thead>
                  <tbody class="govuk-table__body" *ngIf="paymentGroup.remissions?.length > 0">
                    <tr class="govuk-table__row" *ngFor="let remission of paymentGroup.remissions">
                        <td class="govuk-table__cell">{{ remission.remission_reference }}</td>
                        <td class="govuk-table__cell">{{ remission.date_created | date:'dd MMM yyyy HH:mm:ss' }}</td>
                        <td class="govuk-table__cell">{{ remission.hwf_reference }}</td>
                        <td class="govuk-table__cell">{{ remission.fee_code }}</td>
                        <td class="govuk-table__cell">{{ remission.hwf_amount }}</td>
                      </tr>
                  </tbody>
                  <tbody class="govuk-table__body" *ngIf="paymentGroup.remissions?.length === 0">
                    <td class="govuk-table__cell" colspan="5">No remissions recorded</td>
                  </tbody>
                </table>
          </div>
    </details>
  

        <div *ngIf="takePayment">
            <button type="submit" (click)="loadFeeSummaryPage(paymentGroup)"
                                  [disabled]="(getGroupOutstandingAmount(paymentGroup) < 0 || isUnprocessedRecordSelected)"
                                  [ngClass]='(getGroupOutstandingAmount(paymentGroup) < 0 || isUnprocessedRecordSelected) ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'>
                                  Add telephone payment
            </button>

            <button type="submit" disabled="disabled" aria-disabled="true" class="button button--disabled">
                Deduct Remission
            </button>
        </div>
      </div>
    </div>
    <ccpay-app-unprocessed-payments [IS_BUTTON_ENABLE]="takePayment" [PAYMENT_RECORDS_EXISTS]="isPaymentRecordsExist" (selectedUnprocessedFeeEvent) = "selectedUnprocessedFeeEvent($event)" ></ccpay-app-unprocessed-payments>
    <div class="govuk-grid-row govuk-grid__surplus-payments">
    <div class="govuk-grid-column-full govuk-grid__surplus-payments-col1">
      <span class="heading-small">Surplus payments</span>
    </div>
    <div class="govuk-grid-column-full">
       Total surplus payments received: {{calculateRefundAmount() | currency :'GBP':'symbol':'1.2-2'}}
    </div>
    </div>
  </main>


</div>
