<div class="govuk-width-container">

  <main class="govuk-main-wrapper">
    <div  *ngIf="takePayment">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">Case transactions</h1>
      </div>
    </div> 

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds govuk-!-padding-bottom-6 govuk-!-padding-top-6">
        <span> {{ ccdCaseNumber | ccdHyphens }}</span>
      </div>

      <div class="govuk-grid-column-full govuk-!-padding-bottom-3">
        <hr class="govuk-section-break govuk-section-break--visible">
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <td class="govuk-table__header" scope="col">Total payments</td>
              <td class="govuk-table__header" scope="col">Total remissions</td>
              <td class="govuk-table__header" scope="col">Amount due</td>
              <td class="govuk-table__header" scope="col" *ngIf="totalRefundAmount > 0">Total Surplus</td>
              <td class="govuk-table__header" scope="col" *ngIf="isBulkScanEnable">Unallocated payments</td>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            <tr class="totalpayments govuk-table__row">
              <td class="govuk-table__cell">{{ totalPayments | currency :'GBP':'symbol':'1.2-2' }}</td>
              <td class="govuk-table__cell">{{ totalRemissions | currency :'GBP':'symbol':'1.2-2' }}</td>
              <td class="govuk-table__cell">{{ (totalFees - totalRemissions) - totalPayments | currency :'GBP':'symbol':'1.2-2'}}</td>
              <td class="govuk-table__cell" *ngIf="totalRefundAmount > 0">{{totalRefundAmount | currency :'GBP':'symbol':'1.2-2'}}</td>
              <td class="govuk-table__cell case-transaction__color" *ngIf="isBulkScanEnable">{{unprocessedRecordCount}}</td>
            </tr>
          </tbody>
        </table>
      </div>

       <div class="govuk-grid-column-two-thirds govuk-!-padding-bottom-6" *ngIf="takePayment">
        <button type="submit" (click)="redirectToFeeSearchPage($event)"
          [disabled]="!isAddFeeBtnEnabled"
          [ngClass]='!isAddFeeBtnEnabled ? "govuk-button govuk-button--secondary govuk-button--disabled govuk-!-margin-right-1" : "govuk-button govuk-button--secondary govuk-!-margin-right-1"'>
          Add a new fee
        </button>
    </div>
    </div>


    <!-- No fees start -->
    <span class="heading-small">Exisiting fees</span>
    <div *ngIf="paymentGroups?.length === 0">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <span class="heading-small">Existing fees</span>
        </div>

        <div class="govuk-grid-column-full">
          <table class="govuk-table">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <td class="govuk-table__header" scope="col">Code</td>
              <td class="govuk-table__header" scope="col">Description</td>
              <td class="govuk-table__header" scope="col">Volume</td>
              <td class="govuk-table__header" scope="col">Fee amount</td>
              <td class="govuk-table__header" scope="col">Calculated amount</td>
              <td class="govuk-table__header" scope="col">Amount due</td>

            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <td class="govuk-table__cell" colspan="6">No fees recorded</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- No fees end -->
    <div *ngFor="let paymentGroup of paymentGroups">
      <div class="govuk-grid-row">
        <!--New Code start-->
        <div class="feeclass"  *ngFor="let fee of paymentGroup.fees;" >
        <table class="govuk-table">
          <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <td class="govuk-table__header" scope="col">Code</td>
            <td class="govuk-table__header" scope="col">Description</td>
            <td class="govuk-table__header" scope="col">Volume</td>
            <td class="govuk-table__header" scope="col">Fee amount</td>
            <td class="govuk-table__header" scope="col">Calculated amount</td>
            <td class="groupamount govuk-table__header" scope="col">Amount due</td>
          </tr>
          </thead>
          <tbody class="govuk-table__body" >
          <tr class="govuk-table__row">
            <td class="govuk-table__cell govuk-table__cell--col1">{{fee.code}}</td>
            <td class="govuk-table__cell govuk-table__cell--col2"> {{fee.description}} </td>
            <td class="govuk-table__cell govuk-table__cell--col3 align-center"> {{fee.volume? fee.volume : '-'}} </td>
            <td class="govuk-table__cell govuk-table__cell--col4"> {{ fee.fee_amount | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
            <td class="govuk-table__cell govuk-table__cell--col5"> {{fee.calculated_amount | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
            <td class="govuk-table__cell govuk-table__cell--col6 govuk-table__custom--col6" [attr.rowspan]="paymentGroup.fees.length">
              {{getGroupOutstandingAmount(paymentGroup) | currency:'GBP':'symbol-narrow':'1.2-2' }} </td>
          </tr>
          </tbody>
          <tbody class="govuk-table__body" *ngIf="paymentGroup.fees.length==0">
          <td class="govuk-table__cell" colspan="6">No payments recorded</td>
          </tbody>
        </table>
        <div class="govuk-inset-text govuk-inset-text__no-border govuk-inset-text__no-left-margin" *ngIf="paymentGroup.payments || paymentGroup.remissions">
          <details>
            <summary class="govuk-hidetext">
            <span class="summary">Allocated payments and remissions</span>
            </summary>
    
              <div class="panel panel-border-narrow">
                  <!-- payments -->
                    <table class="govuk-table">
                      <caption class="heading-medium headgovuk-table__caption">Payments</caption>
                      <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <td class="govuk-table__header" scope="col">Payment reference</td>
                            <td class="govuk-table__header" scope="col">Date created</td>
                            <td class="govuk-table__header" scope="col">Channel</td>
                            <td class="govuk-table__header" scope="col">Method</td>
                            <td class="govuk-table__header" scope="col">Amount</td>
                            <td class="govuk-table__header" scope="col">Status</td>
                          </tr>
                      </thead>
                      <!-- <tbody class="govuk-table__body" *ngIf="paymentGroup.payments?.length > 0">
                        <tr class="govuk-table__row"  *ngFor="let payment of paymentGroup.payments">
                            <td class="govuk-table__cell">
                              <a href="javascript:void(0)" (click)="goToPaymentViewComponent({paymentGroup.payment_group_reference, payment.reference, payment.method})">{{ payment.reference }}</a>
                            </td>
                            <td class="govuk-table__cell">{{ payment.date_created | date:'dd MMM yyyy HH:mm:ss' }}</td>
                            <td class="channel govuk-table__cell">{{ payment.channel | lowercase }}</td>
                            <td class="govuk-table__cell capitalize">{{ payment.method | lowercase}}</td>
                            <td class="govuk-table__cell">{{ payment.amount }}</td>
                            <td class="govuk-table__cell"> {{getAllocationStatus(payment)}}</td>
                            <td class="govuk-table__cell">{{ payment.status }}</td>
                          </tr>
                      </tbody> -->
                      <tbody class="govuk-table__body">
                        <td class="govuk-table__cell" colspan="7">No payments recorded</td>
                      </tbody>
                    </table>
    
                    <!-- remissions -->
                    <table class="govuk-table">
                      <caption class="heading-medium headgovuk-table__caption">Remissions</caption>
                      <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <td class="govuk-table__header" scope="col">Remission reference</td>
                            <td class="govuk-table__header" scope="col">Date created</td>
                            <td class="govuk-table__header" scope="col">Remission code</td>
                            <td class="govuk-table__header" scope="col">Amount</td>
                          </tr>
                      </thead>
                      <tbody class="govuk-table__body" *ngIf="paymentGroup.remissions?.length > 0">
                        <tr class="govuk-table__row" *ngFor="let remission of getRemissionDetails(paymentGroup.remissions, fee.code)">
                            <td class="govuk-table__cell">{{ remission.remission_reference }}</td>
                            <td class="govuk-table__cell">{{ remission.date_created | date:'dd MMM yyyy HH:mm:ss' }}</td>
                            <td class="govuk-table__cell">{{ remission.hwf_reference }}</td>
                            <td class="govuk-table__cell">{{ remission.hwf_amount }}</td>
                          </tr>
                      </tbody>
                      <tbody class="govuk-table__body" *ngIf="paymentGroup.remissions?.length === 0">
                        <td class="govuk-table__cell" colspan="5"><a href="javascript:void(0)" (click)="redirectToFeesummaryPage(paymentGroup.payment_group_reference)">Deduct remission</a></td>
                      </tbody>
                    </table>
              </div>
          </details>
          </div>
      </div>
      </div>
    </div>
  </div>
    <ccpay-app-unprocessed-payments
      *ngIf="isBulkScanEnable"
      [IS_BUTTON_ENABLE]="takePayment"
      [FEE_RECORDS_EXISTS]="isFeeRecordsExist" 
      [IS_OS_AMT_AVAILABLE]="isGrpOutstandingAmtPositive" 
      (getUnprocessedFeeCount) = "getUnprocessedFeeCount($event)"
      (selectedUnprocessedFeeEvent) = "selectedUnprocessedFeeEvent($event)">
    </ccpay-app-unprocessed-payments>

    <ccpay-app-processed-payments
    *ngIf="nonPayments.length > 0"
    [NONPAYMENTS]="nonPayments"
    (goToPaymentViewComponent) = "goToPaymentViewComponent($event)"
    ></ccpay-app-processed-payments>
    <div class="govuk-grid-row govuk-grid__surplus-payments"  *ngIf="totalRefundAmount > 0">
      <div class="govuk-grid-column-full govuk-grid__surplus-payments-col1">
        <h3 class="heading-medium">Surplus payments</h3>
      </div>
      <div class="govuk-grid-column-full">
        Total surplus payments received: {{totalRefundAmount | currency :'GBP':'symbol':'1.2-2'}}
      </div>
    </div>
  </main>

