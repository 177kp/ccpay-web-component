  
<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <a (click)="redirectToFeeSearchPage($event)"  class="govuk-back-link govuk-label">Back</a>
    </li>
  </ol>
</div>

<div class="fee-summary" *ngIf="viewStatus === 'main'">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">Fee Summary</h1>
    </div>

    <div class="govuk-grid-column-one-third" align="right">
      <a [href]="'/fee-search?ccdCaseNumber=' + ccdCaseNumber + '&paymentGroupRef=' + paymentGroupRef" class="button">Add a new fee</a>
    </div>
  </div>
  <div *ngIf="errorMessage">
    <div class="error-summary" role="group" aria-labelledby="failure-error-summary-heading" tabindex="-1">
      <h2 class="heading-medium error-summary-heading" id="failure-error-summary-heading">
        Payment Group details could not be retrieved
      </h2>
      <div class="govuk-error-summary__body">
        {{ errorMessage }}
      </div>
    </div>
  </div>
  
  <table class="govuk-table"  *ngIf="!errorMessage && paymentGroup">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th class="govuk-table__header govuk-!-font-weight-bold" scope="col">Fee Code</th>
        <th class="govuk-table__header govuk-!-font-weight-bold" scope="col">Fee description</th>
        <th class="govuk-table__header govuk-!-font-weight-bold" scope="col">Remission code</th>
        <th class="govuk-table__header govuk-!-font-weight-bold" scope="col"></th>
      </tr>
    </thead>
    <tbody class="govuk-table__body" *ngIf="paymentGroup.fees">
      <tr class="govuk-table__row" *ngFor="let fee of paymentGroup.fees">
        <td class="govuk-table__cell">{{ fee.code }}</td>
        <td class="govuk-table__cell">{{ fee.description }}</td>
        <td class="govuk-table__cell">{{ getRemissionByFeeCode(fee.code)?.hwf_reference }}</td>
        <td class="govuk-table__cell grey-text">
          <table class="govuk-table">
            <tr class="govuk-table__row">
              <td class="no-border grey-text subcolumn-1">Fee amount:</td>
              <td class="no-border subcolumn-2">{{ fee.calculated_amount | currency:'GBP':'symbol-narrow':'1.2-2' }}</td>
              <td class="no-border subcolumn-3"><a href="">remove fee</a></td>
            </tr>
            <tr class="govuk-table__row" *ngIf="fee.volume && fee.volume > 0">
              <td class="no-border grey-text subcolumn-1">Volume:</td>
              <td class="no-border subcolumn-2">{{ fee.volume }}</td>
              <td class="no-border subcolumn-3"></td>
            </tr>
            <tr class="govuk-table__row">
              <td class="no-border grey-text subcolumn-1">Fee total:</td>
              <td class="no-border subcolumn-2">{{ fee.calculated_amount  | currency:'GBP':'symbol-narrow':'1.2-2' }}</td>
              <td class="no-border subcolumn-3"></td>
            </tr>
            <tr class="govuk-table__row">
              <td class="no-border grey-text subcolumn-1">Remission amount:</td>
              <td class="no-border subcolumn-2">{{ getRemissionByFeeCode(fee.code)?.hwf_amount? ( getRemissionByFeeCode(fee.code)?.hwf_amount  | currency:'GBP':'symbol-narrow':'1.2-2') : '-' }}</td>
              <td class="no-border subcolumn-3"> <a *ngIf="getRemissionByFeeCode(fee.code) === null" (click)="addRemission(fee)">add remission</a></td>
            </tr>
            <tr class="govuk-table__row">
              <td class="no-border grey-text subcolumn-1">Total after remission:</td>
              <td class="no-border subcolumn-2">{{ fee.net_amount  | currency:'GBP':'symbol-narrow':'1.2-2' }}</td>
              <td class="no-border subcolumn-3"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr class="govuk-table__row">
        <td class="no-border"></td>
        <td class="no-border"></td>
        <td class="no-border"></td>
        <td class="no-border"> 
          <table class="govuk-table">
            <tr class="govuk-table__row">
              <td class="no-border govuk-!-font-weight-bold subcolumn-1">Total to be paid</td>
              <td class="no-border subcolumn-2">{{ totalFee | currency:'GBP':'symbol-narrow':'1.2-2'}}</td>
              <td class="no-border subcolumn-3"></td>
            </tr>
          </table>
        </td>
      </tr>
    </tbody>
    <tr class="govuk-table__row">
      <td class="no-border"></td>
      <td class="no-border"></td>
      <td class="no-border"></td>
      <td class="no-border"> 
          <table class="govuk-table">
            <tr class="govuk-table__row">
              <td class="no-border subcolumn-2"> 
                <button type="submit" (click)="takePayment()"
                [disabled]="totalFee <= 0"
                [ngClass]='totalFee <= 0 ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'>
                Take payment
              </button></td>
            </tr>
          </table>
      </td>
    </tr>
  </tbody>
  </table>
</div>
<ccpay-add-remission *ngIf="viewStatus === 'add_remission' && currentFee" [fee]="currentFee" [ccdCaseNumber]="ccdCaseNumber" [paymentGroupRef]="paymentGroupRef" (cancelRemission)="cancelRemission()"></ccpay-add-remission>
<div *ngIf="viewStatus === 'payhub_view' && payhubHtml" [innerHTML]="payhubHtml | sanitizeHtml" id="payhub-html-id"></div>